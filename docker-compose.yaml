services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: monorepo-backend
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=production
      - PORT=4000
      # Si usas SQLite, la URL suele ser file:./dev.db
      # Aseg√∫rate de que coincida con tu .env o schema.prisma
      - DATABASE_URL=file:./dev.db
    volumes:
      # Persistencia para SQLite
      - backend_data:/app/prisma
    networks:
      - monorepo-network

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    container_name: monorepo-frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      # Si el frontend necesita llamar al backend desde el navegador (cliente), usa localhost:4000
      # Si es Server Side Rendering (SSR) llamando al backend, usa http://backend:4000
      - NEXT_PUBLIC_API_URL=http://localhost:4000
    depends_on:
      - backend
    networks:
      - monorepo-network

  docs:
    build:
      context: .
      dockerfile: docs/Dockerfile
    container_name: monorepo-docs
    ports:
      - "8080:80"
    networks:
      - monorepo-network

volumes:
  backend_data:

networks:
  monorepo-network:
    driver: bridge
